<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Route Planner</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    .table-container { max-height: 60vh; overflow-y: auto; position: relative; }
    thead th { position: sticky; top: 0; z-index: 20; background-color: #e5e7eb; }
    thead tr:nth-child(2) th { top: 45px; z-index: 20; }
    tfoot { position: sticky; bottom: 0; z-index: 20; background-color: #f3f4f6; border-top: 2px solid #d1d5db; }
    .progress-bar-fill { transition: width 0.3s ease; }
  </style>
</head>

<body class="bg-gray-100 h-screen w-screen flex flex-col">

<header class="bg-blue-700 text-white p-4 shadow-md flex items-center gap-3">
    <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9 20l-5.447-2.724A2 2 0 013 15.382V6a2 2 0 012-2h1m5 0h1a2 2 0 012 2v7.382a2 2 0 01-1.553 1.894L9 20zm0 0h6" />
    </svg>
    <h1 class="text-2xl font-bold tracking-wide">Route Planner</h1>
</header>

<main class="flex-1 overflow-auto p-6">
    <div class="w-full bg-white shadow rounded-xl p-6">

      <!-- UPLOAD -->
      <div class="mb-6">
        <label class="block text-gray-800 mb-2 font-semibold">Selecione um arquivo .xlsx</label>
        <div class="flex gap-4">
            <input id="fileInput" type="file" accept=".xlsx"
                   class="flex-1 border p-3 rounded-lg cursor-pointer hover:border-gray-400">
            <button id="btnUpload"
                    class="bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition shadow-md">
                Enviar
            </button>
        </div>

        <div id="progressContainer" class="mt-4 hidden">
            <div class="flex justify-between mb-1">
                <span id="progressStatus" class="text-sm font-medium text-blue-700">Enviando...</span>
                <span id="progressPercent" class="text-sm font-medium text-blue-700">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 shadow-inner overflow-hidden">
                <div id="progressBar" class="bg-blue-600 h-4 rounded-full progress-bar-fill" style="width:0"></div>
            </div>
        </div>

      </div>

      <!-- RESULTADO -->
      <div id="result" class="mt-8 hidden">
        
        <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h2 class="text-2xl font-semibold text-gray-800">Resultado da Análise</h2>

            <button id="btnExport" onclick="openPopup()"
                    class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center shadow-sm">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Exportar
            </button>
        </div>

        <div class="border border-gray-300 rounded-lg shadow-sm bg-white">
            <div class="table-container rounded-t-lg">
                <table class="min-w-full text-sm border-collapse" id="dataTable">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody"></tbody>
                    <tfoot class="text-gray-700 font-semibold bg-gray-100">
                        <tr>
                            <td colspan="100%" class="px-4 py-3 text-right">
                                <div class="flex justify-end gap-6">
                                   <span>Total de Linhas: 
                                      <span id="statTotalLines" class="text-blue-600">0</span>
                                  </span>

                                  <span>Linhas com erro: 
                                      <span id="statNotFound" class="text-red-600">0</span>
                                  </span>

                                  <span>Parcialmente encontradas: 
                                      <span id="statPartial" class="text-yellow-600">0</span>
                                  </span>

                                  <span>Marcados como Condomíno: 
                                      <span id="statCond" class="text-purple-600">0</span>
                                  </span>
                                </div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>

        <div class="mt-8">
            <details>
                <summary class="cursor-pointer text-gray-500 hover:text-gray-700">Ver JSON Bruto</summary>
                <pre id="jsonOutput" class="mt-2 bg-gray-900 text-green-300 p-4 rounded-lg text-xs overflow-auto max-h-40"></pre>
            </details>
        </div>

      </div>
    </div>
</main>

<!-- POPUP -->
<div id="exportPopup" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center">
    <div class="bg-white p-6 rounded-xl shadow-xl w-80">
      <h2 class="text-xl font-bold mb-4 text-gray-800">Exportar dados</h2>

      <button id="popupExportExcel"
              class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded mb-3">
        Exportar Excel
      </button>

      <button id="popupExportCircuit"
              class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded">
        Exportar para Circuit
      </button>

      <button onclick="closePopup()"
              class="w-full mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 rounded">
        Cancelar
      </button>
    </div>
</div>

<!-- POPUP SOBRE O SOFTWARE -->
<div id="infoPopup" class="fixed inset-0 bg-black bg-opacity-40 hidden items-center justify-center">
    <div class="bg-white p-7 rounded-xl shadow-2xl w-96 relative border border-gray-300">

        <!-- Botão fechar -->
        <button onclick="closeInfoPopup()" 
                class="absolute top-3 right-3 text-gray-500 hover:text-gray-700 text-xl font-bold">
            ×
        </button>

        <!-- LOGO -->
        <div class="flex flex-col items-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-14 h-14 text-blue-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M9 20l-5.447-2.724A2 2 0 013 15.382V6a2 2 0 012-2h1m5 0h1a2 2 0 012 2v7.382a2 2 0 01-1.553 1.894L9 20zm0 0h6" />
            </svg>

            <h2 class="text-2xl font-bold text-gray-800 mt-2 tracking-wide">Route Planner</h2>
        </div>

        <!-- INFO -->
        <div class="text-gray-700 text-sm space-y-2">
            <p><span class="font-semibold">Descrição:</span><br>
               Software profissional para otimização e planejamento inteligente de rotas de entrega.
            </p>

            <p><span class="font-semibold">Desenvolvedor:</span><br>
               Danilo Carneiro Neri
            </p>

            <p><span class="font-semibold">Contato:</span><br>
               (62) 99625-0706
            </p>

            <p><span class="font-semibold">Email:</span><br>
               danilo.carneironeri@gmail.com
            </p>
        </div>

        <button onclick="closeInfoPopup()" 
                class="w-full mt-6 bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 rounded-lg">
            Fechar
        </button>
    </div>
</div>

<footer onclick="openInfoPopup()" class="bg-gray-200 text-gray-700 text-center py-4 mt-8 border-t cursor-pointer hover:bg-gray-300 transition">
    <p class="text-sm tracking-wide">
        Desenvolvido por <span class="font-semibold">Danilo Carneiro</span> — <span class="underline">Sobre o software</span>
    </p>
</footer>

<script src="script.js"></script>

</body>
</html>